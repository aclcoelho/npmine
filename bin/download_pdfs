#!/usr/bin/env python3

import os
import re
import json
from npmine.retrieve_chemical_entities import download_pdf
import sys

'''usage
   download_pdfs <url_file>
'''

def download_pdfs(url_file, pattern='', rpattern=''):
    if not os.path.exists('pdfs'):
        os.makedirs('pdfs')

    with open(url_file) as f:
        dois = json.load(f)

    for url in dois:
        if pattern!='':
            fl = 'pdfs/%s.pdf' % url.replace(pattern, '').replace('/', '_')
        elif rpattern!='':
            fl = 'pdfs/%s.pdf' %  re.sub(rpattern, '\\1', url)
        else:
            fl = 'pdfs/%s' % url.split('/')[-1]
        download_pdf(url, fl)

if __name__ == '__main__':
    download_pdfs(sys.argv[1], pattern=sys.argv[2], rpattern=sys.argv[2])
